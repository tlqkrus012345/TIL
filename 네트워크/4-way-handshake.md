4-way handshake는 TCP 연결을 종료하기 위한 절차입니다.

한쪽에서만 FIN을 보내고 끝낸다면, 상대방이 아직 데이터를 보내는 중일 수 있기 때문에 데이터 손실이 발생할 수 있습니다.

따라서 서로 독립적으로 종료 동의를 주고받아야 하므로 4단계가 필요합니다.

1. 클라이언트는 현재 시퀀스 번호를 담아 FIN 패킷을 서버에 보냅니다.


2. 서버는 클라이언트의 시퀀스 번호 + 1을 ACK로 하여 ACK 패킷을 클라이언트에게 응답합니다.


3. 이후 서버도 연결 종료를 위해 자신의 시퀀스 번호를 담아 FIN 패킷을 클라이언트에게 보냅니다.


4. 클라이언트는 서버의 시퀀스 번호 + 1 값을 ACK로 하여 ACK 패킷을 전송하고, 일정 시간 동안 TIME_WAIT 상태를 유지해 지연된 패킷을 감지한 후 최종적으로 연결을 종료합니다.